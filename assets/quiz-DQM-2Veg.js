import{b as B,H as D,B as E}from"./header-BhYeFC9Z.js";class S{static getState(){const t=new URLSearchParams(window.location.search),e=t.get("id"),s=Number(t.get("question"))||1;return{id:e,question:s}}static setQuestion(t){const e=new URL(window.location.href);e.searchParams.set("question",String(t)),history.pushState({},"",e)}}class F{#e=null;#i=1;#t=new Map;#o="answer";constructor(t){if(!t||!Array.isArray(t.questions))throw new Error("Quiz: invalid quizData (questions must be an array)");this.#e=t,this.#n()}#n(){this.#e&&(this.#t=new Map,this.#i=1,this.#o="answer",this.#e.questions.forEach(t=>{this.#t.set(t.id,{questionId:t.id,stage:"idle",correct:null,selectedOptionIds:[]})}))}getQuestionsCount(){return this.#e?this.#e.questions.length:0}getMode(){return this.#o}getCurrentQuestion(){if(!this.#e)return null;const t=this.#i-1,e=this.#e.questions[t];return e?{question:e,number:this.#i}:null}getNextQuestion(){if(!this.#e)return null;const t=this.#i+1;return t>this.#e.questions.length?null:(this.#i=t,this.#o="answer",this.getCurrentQuestion())}isLastQuestion(){return this.#e?this.#i>=this.#e.questions.length:!0}answeredQuestion(t,e){if(!this.#e)throw new Error("Quiz: quiz is not loaded");const s=this.#e.questions.find(o=>o.id===t);if(!s)throw new Error(`Quiz: question ${t} not found`);const c=Array.isArray(e)?e.map(Number).filter(Number.isFinite):[],n=new Set(c),u=[];for(const o of s.options)o.correct&&u.push(o.id);const a=new Set(u),l=n.size===a.size&&(()=>{for(const o of n)if(!a.has(o))return!1;return!0})(),q=new Set(n);if(!l)for(const o of a)q.add(o);const h=new Set;for(const o of n)h.add(o);for(const o of a)h.add(o);const d=s.options.map(o=>({...o,selected:q.has(o.id)})),p=this.#t.get(t),f={questionId:t,stage:"answered",correct:l,selectedOptionIds:[...n]};return p?(p.stage=f.stage,p.correct=f.correct,p.selectedOptionIds=f.selectedOptionIds):this.#t.set(t,f),this.#o="review",{correct:l,checkedOptionIds:[...q],highlightOptionIds:[...h],optionsView:d}}getQuizResult(){if(!this.#e)return null;const t=this.#e.questions.length;let e=0;this.#t.forEach(n=>{n.correct===!0&&(e+=1)});const s=t===0?0:Math.round(e/t*100);let c="bad";return s===100?c="complete":s>=51&&(c="good"),{correctCount:e,total:t,percent:s,status:c}}reset(){this.#i=1,this.#o="answer",this.#t.clear()}}class O{#e;#i=null;#t=null;#o=null;#n=null;#s=null;id=null;inputType="radio";name="";text="";correct=!1;message="";locked=!1;status="neutral";constructor(){this.#e=document.getElementById("quiz__option")}create(t){const{optionId:e,inputType:s,name:c,text:n,correct:u=!1,message:a=""}=t;this.id=e,this.inputType=s,this.name=c,this.text=n,this.correct=!!u,this.message=a;const l=this.#e.content.cloneNode(!0),q=l.querySelector(".quiz__option"),h=l.querySelector(".choice"),d=l.querySelector(".choice__input"),p=l.querySelector(".choice__label"),f=l.querySelector(".choice__tip");return this.#i=q,this.#t=h,this.#o=d,this.#n=p,this.#s=f,this.inputType==="radio"?(h.classList.add("choice--radio"),d.type="radio"):(h.classList.remove("choice--radio"),d.type="checkbox"),d.name=this.name,d.value=String(this.id),p.textContent=this.text,this.#s&&(this.message?(this.#s.textContent=this.message,this.#s.hidden=!0):(this.#s.remove(),this.#s=null)),this.clearStatus(),this.unlock(),q}lock(){this.locked=!0,this.#t.setAttribute("disabled",this.locked),this.#t.setAttribute("aria-disabled","true"),this.#t.style.pointerEvents="none",this.#o.disabled=!0,this.#o.tabIndex=-1}unlock(){this.locked=!1,this.#t.classList.remove("choice--locked"),this.#t.removeAttribute("aria-disabled"),this.#t.style.pointerEvents="",this.#o.tabIndex=0}showCorrectness(t={}){const{showHint:e=!0}=t;this.correct?this.setStatus("success"):this.setStatus("error"),e&&this.#s&&(this.#s.hidden=!1)}setStatus(t){this.status=t,this.#t.classList.remove("choice--success","choice--error"),t==="success"&&this.#t.classList.add("choice--success"),t==="error"&&this.#t.classList.add("choice--error");const e=document.createElement("span");e.classList.add("choice__tip","caption"),e.textContent=this.message,this.#i.appendChild(e)}clearStatus(){this.#t&&(this.status="neutral",this.#t.classList.remove("choice--success","choice--error"),this.#s&&(this.#s.hidden=!0,this.#s.textContent=this.message))}}const w=document.querySelector(".quiz"),L=w.querySelector(".quiz__header"),y=L?.querySelector(".quiz__title"),x=L?.querySelector(".quiz__description"),g=w.querySelector(".quiz__progress-bar"),R=g?.querySelector(".quiz__progress-bar__current-question"),T=g?.querySelector(".quiz__progress-bar__total-question"),$=g?.querySelector(".quiz__progress-bar__progress"),P=$?.querySelector(".quiz__progress-bar__fill"),H=w.querySelector(".quiz__question"),k=H?.querySelector(".quiz__question-header"),Q=k?.querySelector(".quiz__question-title"),C=k?.querySelector(".quiz__question-description"),z=document.forms["question-form"],v=z.querySelector(".quiz__question-options"),I=z.querySelector(".quiz-submit"),m=document.querySelector(".popup"),U=m.querySelector(".popup__title"),V=m.querySelector(".popup__description"),j=m.querySelector(".popup__subtitle"),G=m.querySelector(".popup--close-button"),J=m.querySelector(".popup--restart-button"),_=document.createDocumentFragment();let b=[];const{id:K,question:W}=S.getState(),N=await B(K),r=new F(N),X=new D;X.setButtonItems([{text:"ÐŸÐ¾ÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ ÑÐ¾Ñ…Ñ€Ð°Ð½Ñ‘Ð½Ð½Ñ‹Ðµ ÐºÐ²Ð¸Ð·Ñ‹",href:`${E}quizzes.html`,variant:"secondary"}]);const Y=(i,t,e)=>{const s=Math.max(1,e),n=Math.min(Math.max(t,1),s)/s*100;T.textContent=String(s),R.textContent=String(t),P.style.width=`${n}%`,i.setAttribute("aria-valuenow",String(t)),i.setAttribute("aria-valuemax",String(s))},Z=i=>{const t=r.getQuestionsCount(),e=Math.min(Math.max(Number(i||1),1),Math.max(1,t));for(let s=1;s<e;s++)r.getNextQuestion();S.setQuestion(e)},tt=()=>{const i=new FormData(z);return Array.from(i.values()).map(t=>Number(t)).filter(t=>Number.isFinite(t))},et=i=>{const t=new Set(i.map(Number));for(const e of b){const s=Number(e.id);t.has(s)||e.lock(),t.has(s)?e.showCorrectness({showHint:!0}):e.clearStatus()}I.textContent=r.isLastQuestion()?"Ð—Ð°Ð²ÐµÑ€ÑˆÐ¸Ñ‚ÑŒ Ñ‚ÐµÑÑ‚":"Ð¡Ð»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ð¹ Ð²Ð¾Ð¿Ñ€Ð¾Ñ"},st=()=>{const i=r.getQuizResult();if(!i)return;const e={complete:{title:"Ð¢ÐµÑÑ‚ Ð·Ð°Ð²ÐµÑ€ÑˆÑ‘Ð½!",subtitle:"Ð’Ñ‹ Ð¾Ñ‚Ð²ÐµÑ‚Ð¸Ð»Ð¸ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾ Ð½Ð° Ð²ÑÐµ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹ ðŸŽ‰",description:"Ð’Ð°ÑˆÐ¸ Ð·Ð½Ð°Ð½Ð¸Ñ Ð² ÑÑ‚Ð¾Ð¹ Ñ‚ÐµÐ¼Ðµ Ð½Ð° Ð²Ñ‹ÑÐ¾Ñ‚Ðµ!"},good:{title:"Ð¢ÐµÑÑ‚ Ð·Ð°Ð²ÐµÑ€ÑˆÑ‘Ð½!",subtitle:`Ð’Ñ‹ Ð¾Ñ‚Ð²ÐµÑ‚Ð¸Ð»Ð¸ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾ Ð½Ð° ${i.correctCount} Ð¸Ð· ${i.total} Ð²Ð¾Ð¿Ñ€Ð¾ÑÐ¾Ð²`,description:"ÐžÑ‚Ð»Ð¸Ñ‡Ð½Ð°Ñ Ð¿Ð¾Ð¿Ñ‹Ñ‚ÐºÐ°! Ð’Ñ‹ Ñ…Ð¾Ñ€Ð¾ÑˆÐ¾ Ð¾Ñ‚Ð²ÐµÑ‚Ð¸Ð»Ð¸ Ð½Ð° Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹ Ñ‚ÐµÑÑ‚Ð°, Ð½Ð¾ Ð½ÐµÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ñ‚ÐµÐ¼Ñ‹ ÑÑ‚Ð¾Ð¸Ñ‚ Ð¾ÑÐ²ÐµÐ¶Ð¸Ñ‚ÑŒ. ÐŸÑ€Ð¾Ð¹Ð´Ð¸Ñ‚Ðµ Ñ‚ÐµÑÑ‚ ÐµÑ‰Ñ‘ Ñ€Ð°Ð·, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð·Ð°ÐºÑ€ÐµÐ¿Ð¸Ñ‚ÑŒ Ð·Ð½Ð°Ð½Ð¸Ñ."},bad:{title:"ÐÐµ Ñ€Ð°ÑÑÑ‚Ñ€Ð°Ð¸Ð²Ð°Ð¹Ñ‚ÐµÑÑŒ!",subtitle:`Ð’Ñ‹ Ð¾Ñ‚Ð²ÐµÑ‚Ð¸Ð»Ð¸ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾ Ð½Ð° ${i.correctCount} Ð¸Ð· ${i.total} Ð²Ð¾Ð¿Ñ€Ð¾ÑÐ¾Ð²`,description:"ÐÐµ Ð¿ÐµÑ€ÐµÐ¶Ð¸Ð²Ð°Ð¹Ñ‚Ðµ â€” Ð¾ÑˆÐ¸Ð±ÐºÐ¸ ÑÑ‚Ð¾ Ñ‡Ð°ÑÑ‚ÑŒ Ð¾Ð±ÑƒÑ‡ÐµÐ½Ð¸Ñ. ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð¿Ñ€Ð¾Ð¹Ñ‚Ð¸ Ñ‚ÐµÑÑ‚ ÑÐ½Ð¾Ð²Ð°, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð·Ð°ÐºÑ€ÐµÐ¿Ð¸Ñ‚ÑŒ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð» Ð¸ ÑƒÐ»ÑƒÑ‡ÑˆÐ¸Ñ‚ÑŒ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚."}}[i.status];e&&(U.textContent=e.title,j.textContent=e.subtitle,V.textContent=e.description,m.classList.add("popup--open"))},M=()=>{b=[],_.replaceChildren(),v.replaceChildren();const i=r.getCurrentQuestion(),{question:t,number:e}=i,s=t.type==="single",c=s?"radio":"checkbox",n=`question-${t.id}`;Q&&(Q.textContent=t.text),C&&(C.textContent=s?"Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¾Ð´Ð¸Ð½ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚ Ð¾Ñ‚Ð²ÐµÑ‚Ð°":"Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚Ð¾Ð² Ð¾Ñ‚Ð²ÐµÑ‚Ð°"),I.textContent="ÐžÑ‚Ð²ÐµÑ‚Ð¸Ñ‚ÑŒ";for(const u of t.options){const a=new O;_.appendChild(a.create({optionId:u.id,inputType:c,name:n,text:u.text,correct:u.correct,message:u.message})),b.push(a)}v.appendChild(_),g&&Y(g,e,r.getQuestionsCount())},A=()=>{const{title:i,description:t}=N;y&&(y.textContent=i),x&&(x.textContent=t),M()},it=i=>{if(i.preventDefault(),r.getMode()==="answer"){const t=r.getCurrentQuestion();if(!t)return;const e=t.question,s=tt();if(s.length===0){console.warn("Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚ Ð¾Ñ‚Ð²ÐµÑ‚Ð°");return}const c=r.answeredQuestion(e.id,s);et(c.highlightOptionIds);return}if(r.getMode()==="review"){if(r.isLastQuestion()){st();return}const t=r.getNextQuestion();if(!t)return;S.setQuestion(t.number),M()}},ot=()=>{window.location.href=`${E}quizzes.html`},nt=i=>{i.preventDefault(),r.reset(),S.setQuestion(1),A(),m.classList.remove("popup--open")};Z(W);A();z.addEventListener("submit",it);G.addEventListener("click",ot);J.addEventListener("click",nt);
